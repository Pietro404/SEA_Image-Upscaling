[SLIDE 2.2] Gestione della Memoria in CUDA
Shared Memory
• Condivisa tra i thread all'interno di un singolo blocco
• Più veloce, ma limitata in dimensioni
• Esiste solo per la durata del blocco di thread
• Utilizzata per dati temporanei e intermedi

I thread in un blocco possono condividere dati tramite memoria on-chip veloce (es. shared memory),
riducendo gli accessi alla memoria globale più lenta, migliorando dunque significativamente le prestazioni.

Sfruttare la Shared Memory
• La shared memory è una memoria on-chip a bassa latenza accessibile a tutti i thread di un blocco.
• Utilizzare la shared memory per i dati frequentemente acceduti e condivisi tra i thread di un blocco per
ridurre l'accesso alla memoria globale più lenta.

--------

Caricamento di una tile dell’immagine input in shared memory
Ogni blocco carica:
(blockDim + halo) per bilinear/bicubic

Benefici:
Riduzione drastica degli accessi globali
Riutilizzo dei pixel tra thread dello stesso blocco

Metriche da confrontare:
dram__bytes_read --
l1tex__data_hit_rate ++

Speedup netto, soprattutto per bilinear/bicubic

L'efficacia della Shared Memory dipende dal rapporto di riutilizzo dei dati (Data Reuse):

    - Nearest Neighbor (Basso impatto): Ogni pixel di output ha bisogno di 1 solo pixel di input. Anche se molti thread leggono lo stesso pixel (es. in un upscaling 4x), la cache L1/L2 della GPU gestisce questa ridondanza. L'uso della Shared Memory qui spesso non dà grandi vantaggi prestazionali e serve più che altro a scopo didattico.
In questo caso, l'halo è minimo (0 o 1 pixel a seconda dell'arrotondamento), ma si carica comunque una tile per coerenza.

    - Bilineare (Medio impatto): Ogni pixel di output richiede un intorno 2x2 (4 pixel). Qui il riutilizzo aumenta: i thread adiacenti condividono 2 dei 4 pixel necessari. La Shared Memory riduce le transazioni verso la memoria globale.
L'interpolazione bilineare richiede l'accesso a (x0, y0) e (x0+1, y0+1). L'halo necessario è quindi di +1 pixel a destra e in basso.

    - Bicubica (Alto impatto): Richiede un intorno 4x4 (16 pixel) quindi il riutilizzo è ampio. Senza Shared Memory, la banda di memoria diventa il collo di bottiglia istantaneo.
